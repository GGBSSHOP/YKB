<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ᅟ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial Black', 'Helvetica Neue', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            overflow: hidden;
        }
        
        #message {
            font-weight: 900;
            text-transform: uppercase;
            text-align: center;
            width: 100%;
            max-width: 90vw;
            padding: 5vw;
            border-radius: 4vw;
            word-break: break-word;
            
            /* Адаптивный размер шрифта */
            font-size: 15vw;
            
            /* Для очень маленьких экранов */
            line-height: 1.2;
            
            /* Эффекты текста */
            letter-spacing: 0.5vw;
            text-shadow: 
                0.3vw 0.3vw 0 rgba(0,0,0,0.1),
                0.6vw 0.6vw 0 rgba(0,0,0,0.05);
            
            /* Анимация появления */
            animation: appear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .ekb {
            color: #27ae60;
            background: linear-gradient(145deg, #e8f8f1, #ffffff);
            border: 1.5vw solid #27ae60;
            box-shadow: 
                0 2vw 4vw rgba(39, 174, 96, 0.2),
                inset 0 1vw 2vw rgba(255, 255, 255, 0.8);
        }
        
        .notekb {
            color: #e74c3c;
            background: linear-gradient(145deg, #fdedec, #ffffff);
            border: 1.5vw solid #e74c3c;
            box-shadow: 
                0 2vw 4vw rgba(231, 76, 60, 0.2),
                inset 0 1vw 2vw rgba(255, 255, 255, 0.8);
        }
        
        .yandex {
            color: #00000;
            background: linear-gradient(145deg, #ffcc00, #ffcc00);
            border: 1.5vw solid #000000;
            box-shadow: 
                0 2vw 4vw rgba(255, 204, 0, 9);
            text-shadow: 
                0.3vw 0.3vw 0 rgba(255, 51, 51, 0.2),
                0.6vw 0.6vw 0 rgba(255, 51, 51, 0.1);
        }
        
        /* Анимация */
        @keyframes appear {
            0% { 
                opacity: 0; 
                transform: scale(0.7) rotate(-5deg); 
            }
            70% {
                transform: scale(1.05) rotate(1deg);
            }
            100% { 
                opacity: 1; 
                transform: scale(1) rotate(0deg); 
            }
        }
        
        /* Медиа-запросы для разных устройств */
        @media (min-width: 768px) {
            #message {
                font-size: 10vw;
                padding: 4vw;
                border-width: 1vw;
            }
        }
        
        @media (min-width: 1024px) {
            #message {
                font-size: 8vw;
                max-width: 80vw;
            }
        }
        
        @media (min-width: 1200px) {
            #message {
                font-size: 6vw;
                max-width: 70vw;
            }
        }
        
        /* Для очень высоких экранов */
        @media (max-height: 500px) and (orientation: landscape) {
            #message {
                font-size: 10vh;
                padding: 3vh;
                max-width: 90vh;
            }
        }
    </style>
</head>
<body>
    <div id="message">...</div>
    
    <!-- Подключаем конфиг с токеном -->
    <script src="config.js"></script>
    
    <script>
        // === ФУНКЦИИ ===
        
        // Получение времени в формате ЧЧ:ММ:СС
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ru-RU', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // ПРОСТАЯ и точная проверка Яндекс
        function isYandexUser() {
            try {
                const ua = navigator.userAgent || '';
                const referrer = document.referrer || '';
                const searchParams = new URLSearchParams(window.location.search);
                
                console.log('User Agent:', ua);
                
                // 1. Проверяем ВСЕ известные Яндекс user agent строки
                const yandexPatterns = [
                    'YaBrowser',           // Яндекс.Браузер
                    'YandexBrowser',       // Яндекс.Браузер
                    'YaSearchBrowser',     // Тот что ты нашел
                    'YaSearchApp',         // Тот что ты нашел  
                    'YandexSearch',        // Поиск Яндекса
                    'YandexMobile',        // Мобильный Яндекс
                    'com.yandex.searchapp', // Приложение Яндекса
                    'YandexSearchBrowser', // Возможный вариант
                    'YaApp',               // Яндекс приложение
                    'BroPP',               // Из твоего примера
                    'webOmni'              // Из твоего примера
                ];
                
                // Проверяем каждую строку
                for (const pattern of yandexPatterns) {
                    if (ua.includes(pattern)) {
                        console.log(`✓ Обнаружен Яндекс по паттерну: ${pattern}`);
                        return true;
                    }
                }
                
                // 2. Проверяем реферер (если пришел с Яндекса)
                if (referrer.includes('yandex.') || referrer.includes('ya.ru')) {
                    console.log('✓ Пришел с Яндекса по рефереру');
                    return true;
                }
                
                // 3. Проверяем Яндекс параметры
                if (searchParams.has('yclid') || 
                    searchParams.has('_ym_uid') || 
                    searchParams.has('yandexuid') ||
                    searchParams.toString().includes('yandex')) {
                    console.log('✓ Обнаружены Яндекс параметры');
                    return true;
                }
                
                // 4. Специальная проверка для Chrome с Яндекс поиском
                // Если user agent содержит Chrome И есть поисковые параметры
                // И русский язык - считаем Яндексом (агрессивно)
                if (ua.includes('Chrome') && !ua.includes('YaBrowser')) {
                    const hasSearchParam = searchParams.has('q') || 
                                         searchParams.has('text') || 
                                         searchParams.has('query');
                    
                    // Если есть поисковый параметр И русский язык
                    if (hasSearchParam) {
                        const isRussian = navigator.language.includes('ru') || 
                                        navigator.languages.some(lang => lang.includes('ru'));
                        
                        if (isRussian) {
                            console.log('✓ Chrome с RU языком и поисковыми параметрами - считаем Яндексом');
                            return true;
                        }
                    }
                }
                
                console.log('✗ Не Яндекс');
                return false;
                
            } catch (error) {
                console.error('Ошибка проверки:', error);
                return false;
            }
        }
        
        // Отправка в Telegram
        async function sendToTelegram(city, isEkb, isYandexUser) {
            try {
                if (!window.CONFIG || !window.CONFIG.TELEGRAM_BOT_TOKEN || 
                    window.CONFIG.TELEGRAM_BOT_TOKEN === 'ВАШ_ТОКЕН_БОТА') {
                    return;
                }
                
                const time = getCurrentTime();
                let emoji, status;
                
                if (isYandexUser) {
                    emoji = '⚠️';
                    status = 'Яндекс';
                } else if (isEkb) {
                    emoji = '✅';
                    status = 'ЕКБ';
                } else {
                    emoji = '❌';
                    status = 'Чужой';
                }
                
                const message = `${emoji} ${time} - ${status} - ${city}`;
                
                fetch(`https://api.telegram.org/bot${window.CONFIG.TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: window.CONFIG.TELEGRAM_CHAT_ID,
                        text: message,
                        disable_notification: true
                    })
                }).catch(() => {});
                
            } catch (error) {}
        }
        
        // === ОСНОВНАЯ ЛОГИКА ===
        
        // Показываем точку пока загружается
        document.getElementById('message').textContent = '●';
        
        // Сначала проверяем Яндекс
        const yandexCheck = isYandexUser();
        
        // Если Яндекс - сразу блокируем
        if (yandexCheck) {
            document.getElementById('message').textContent = 'иди на хуй';
            document.getElementById('message').className = 'yandex';
            
            // Параллельно получаем город для Telegram
            fetch('https://ipinfo.io/json')
                .then(response => response.json())
                .then(data => {
                    const city = data.city || 'Неизвестно';
                    sendToTelegram(city, false, true);
                })
                .catch(() => {
                    sendToTelegram('Неизвестно', false, true);
                });
        } else {
            // Если не Яндекс - проверяем геолокацию
            fetch('https://ipinfo.io/json')
                .then(response => response.json())
                .then(data => {
                    const city = data.city || 'Неизвестно';
                    const cityLower = city.toLowerCase();
                    const messageElement = document.getElementById('message');
                    
                    const isEkb = cityLower.includes('yekaterinburg') || 
                                 cityLower.includes('ekaterinburg') || 
                                 cityLower.includes('екатеринбург') || 
                                 cityLower.includes('екб');
                    
                    sendToTelegram(city, isEkb, false);
                    
                    if (isEkb) {
                        messageElement.textContent = 'ПРИВЕТ!';
                        messageElement.className = 'ekb';
                    } else {
                        messageElement.textContent = 'УХОДИ!';
                        messageElement.className = 'notekb';
                    }
                })
                .catch(error => {
                    document.getElementById('message').textContent = 'УХОДИ!';
                    document.getElementById('message').className = 'notekb';
                    sendToTelegram('Ошибка', false, false);
                });
        }
    </script>
</body>
</html>
